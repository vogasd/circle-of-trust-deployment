apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: circle-prod

bases:
  - ../../base

# Production-specific labels
commonLabels:
  environment: production
  tier: production

# Production-specific annotations
commonAnnotations:
  notifications.argoproj.io/subscribe.on-deployed.slack: circle-deployments
  notifications.argoproj.io/subscribe.on-health-degraded.slack: circle-alerts

# Resource scaling for production
replicas:
  - name: circle-backend
    count: 5
  - name: circle-frontend
    count: 3

# Production-specific patches
patchesStrategicMerge:
  - backend-patch.yaml
  - frontend-patch.yaml
  - ollama-patch.yaml

# Resource limits for production
patches:
  - target:
      kind: Deployment
      name: circle-backend
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/cpu
        value: "2000m"
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/memory
        value: "4Gi"
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/cpu
        value: "500m"
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/memory
        value: "1Gi"

# Production images (will be updated by CI/CD)
images:
  - name: circlerecristry.azurecr.io/circle-backend
    newTag: latest
  - name: circlerecristry.azurecr.io/circle-frontend
    newTag: latest
  - name: circlerecristry.azurecr.io/circle-ollama
    newTag: latest
